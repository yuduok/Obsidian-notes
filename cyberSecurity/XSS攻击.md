## XSS跨站脚本攻击概述

Cross Site Script跨站脚本攻击指恶意攻击者往Web页面里**插入恶意html代码**，当用户浏览该网页，潜入其中Web里面的html会被执行，从而到达恶意攻击用户的目的

#### 危害

- XSS通常会在有漏洞的程序中插入JavaScript、VBScript、ActiveX或flash欺骗用户以**搜集用户信息**
- 攻击成功可以**盗取用户帐户、修改用户设置、盗取/污染cookie、做虚假广告、查看主机信息**等

#### 发起条件

原因：Web服务器没有对用户的输入进行有效性验证，而又轻易地将它们返回给客户端

- 需要存在XSS漏洞的web应用程序
- 需要向web页面注入恶意代码
- 恶意代码被浏览器成功执行
- 用户点击链接或访问某一页面

#### 攻击过程

- 寻找XSS漏洞
- 注入恶意代码
- 欺骗用户访问

## 反射型XSS攻击

**数据流向是前端-->后端-->前端**

#### 获取cookie

1. 黑客首先向服务器发送js脚本
2. 服务器将含有js脚本的页面发送给黑客
3. 黑客将js脚本的页面url发送给用户
4. **黑客获取用户的cookie**

#### 重定向

1. 黑客首先向服务器发送js脚本
2. 服务器将含有js脚本的页面发送给黑客
3. 黑客将js脚本的页面url发送给用户
4. **用户点击url重定向到第三方网站**

## 存储型XSS攻击

**数据流向是前端-->后端-->数据库-->后端-->前端**

#### 获取cookie

1. 黑客首先向服务器发送js脚本
2. **服务器将js页面存储在服务器上**，并将含有js脚本的页面发送给黑客
3. 当用户访问服务器时，服务器返回js页面
4. 黑客获取用户的cookie

#### 重定向

1. 黑客首先向服务器发送js脚本
2. **服务器将js页面存储在服务器上**，并将含有js脚本的页面发送给黑客
3. 当用户访问服务器时，服务器返回js页面
4. 用户点击url重定向到第三方网站

## DOM-based型XSS攻击

类似于反射型XSS，但是是通过对DOM树的修改而实现的

**数据流向是URL-->浏览器（前端），不经过后端**

## 防御跨站脚本攻击

出发点分析：XSS攻击目标不是web服务器而是用户，因此要分析**用户**和**web应用开发者**

1. 用户
   - 点击链接要小心
   - 安装安全的插件

2. web应用开发者
   - 对用户提交内容进行可靠性验证
   - 保护所有敏感的功能

#### XSS攻击防范

1. 将重要的**Cookies标记为http only**
2. 只允许用户输入期望的数据
3. 对数据进行**html encode**处理
4. 过滤或移出特殊的html标签
5. 过滤javascript事件的标签