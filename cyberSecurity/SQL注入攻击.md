
Structured Query Language 结构化查询语言

### SQL注入原理

程序员编写代码时**没有对用户输入数据的合法性进行判断**，攻击者可以提交**精心设计的数据库查询代码**，获得数据或进行数据库操作

### 测试网站是否存在SQL注入

1. 在参数后面加上**单引号’**，例如 id=1‘，页面报错则存在sql注入，未报错也不一定不存在sql注入，可以通过其他方式进行注入
   可以根据报错信息得知后台数据库类型
2. 在末尾加上**分号;**，例如id=1;
3. 在末尾加 and 1=2 和 1=1 
   前者返回信息：该栏目为内容将返回上一页
   后者正常返回
   则说明该网站一定存在sql注入

### SQL代码中的特殊字符

- ? 连接符
- and、or 大小写不敏感
- ""、'' 双引号单引号
- /* ......\*/多行注释
- != 、<>不等于
- ' --+注释和闭合
- \-- 注释后面的内容
- \# 后面的语句全部无效
### SQL注入分类

#### 按变量类型

1. 数字型注入
   - 加单引号，语句出错
   - 加and 1=1 ，语句正常执行
   - 加and 1-2，语句正常执行但无法查询结果
     若满足以上三点，则存在数字型注入
2. 字符型注入
   数字型不需要单引号闭合但字符型一般需要
   - 加单引号，程序报错
   - 加' and 1=1-- 成功执行
   - 加and 1=1-- ，程序报错
     若满足以上三点，则存在字符型注入
     ps：Mysql通常有三种常用注释，**--** （--后面跟空格）、**#**、**/* \*/**

#### 按HTTP提交方式分

1. GET注入
   注入点在GET参数部分，例如www.xxx.com/news.php?**id=1**
2. POST注入
   注入点在POST数据部分，常发生在表单（登陆框、查询框、各种与数据库有交互的框）
3. Cookie注入
   HTTP请求时会带上客户端的cookie，注入点存在Cookie当中的某个字段中

#### 按注入方式分

1. 盲注
   不能通过直接显示的途径来获取数据库数据的方法，只能通过页面返回正常不正常来判断是否存在注入。
   
   盲注的基本条件
   1. 用户能控制输入
   2. 原程序要执行的代码拼接了用户输入的数据。

   盲注的类型
   - 布尔盲注（猜对了立马回显，猜错报错）
   - 时间盲注（利用 **sleep()** 或benchmark()等函数让mysql执行时间变长，结合if判断，通过页面的响应时间来判断条件是否正确）
   - 错误盲注

2. union注入

#### 编码问题

宽字节注入
### SQL注入的防范

- 对用户提交的数据和输入参数进行严格的过滤
- 摒弃动态SQL语言，改用用户存储过程来访问和操作数据

### Google Hacking

利用google的高级搜索功能来发现敏感信息

a) 基础操作符

- `site:` 搜索特定网站
- `intitle:` 搜索标题中包含特定词语的页面
- `inurl:` 搜索URL中包含特定词语的页面
- `filetype:` 搜索特定文件类型

b) 高级操作符

- `intext:` 搜索正文中包含特定词语的页面
- `cache:` 查看网页的缓存版本
- `link:` 查找链接到特定网站的页面
- `related:` 查找与某网站相关的网站

#### 实际应用

例如在Google中搜索intitle:"index of" password.txt

### 网页验证码攻击

验证码技术属于人机区分问题，称为CAPTCHA（Completely Automated Public Turing Test to Tell Computers and Humans Apart，全自动区分计算机和人类的图灵测试）

**主要作用**：防止暴力破解、防止恶意灌水、防止自动提交

#### 验证码技术

背景：基于表单的自动提交HTTP攻击
	攻击者短时间注册大量账户浪费器资源、发表成千上万垃圾帖子导致服务器崩溃、反复登录暴力破解、实施SQL注入或其他脚本攻击

为了防止这种行为，验证码技术得到广泛应用，也就是流程多了图片验证码的生成与验证机制。

**验证码类型**
- 文本验证码（写在html文件中，安全性差）
- 手机验证码（但可能会导致用户被不断骚扰）
- 邮件验证码（依赖邮件服务器）
- 图片验证码

### 防御Web攻击

#### Web服务器安全配置

包括主机系统的安全配置和Web服务器的安全配置

**主机系统的安全配置**
- 简单性（卸载不必要的服务）
- 超级用户权限（不要用超级用户来维护系统）
- 本地和远程访问控制
- 审计和可审计性（平时对记录进行审计）
- 恢复（备份）

**Web服务器安全配置**
1. 基于Windows系统Web服务器安全配置
   - IIS安全安装（internet information server）
     不要安装在系统分区、修改默认安装路径、打最新补丁等
   - IIS安全配置
     删除不必要虚拟目录、删除危险组件等

2. 基于Unix系统Web服务器安全配置
   - 不要把FTP目录与CGI-BIN放在同一目录
   - 设置好系统文件权限和属性（Read、Excute、Write）